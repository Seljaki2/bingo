<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Bingo ‚Äî Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes clickAnimation {
  0%   {background-color:white;}
  25%  {background-color:red;}
  50%  {background-color:yellow;}
  75%  {background-color:lightgreen;}
  100% {background-color:lightblue;}
}
    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-6 lg:p-10 font-sans">
<main class="max-w-7xl mx-auto space-y-8">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <h1 class="text-3xl font-bold text-center flex-1 text-gray-800">Quiz Bingo! üéØ</h1>
        <button
                onclick="window.location.href='index.html'"
                class="px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-100 transition-colors font-semibold">
            New Game
        </button>
    </div>
    <p>Game data:</p>
    <!-- Question Card -->
    <section class="bg-white shadow-2xl rounded-2xl p-6 space-y-6">
        <div class="flex items-center justify-between">
            <span id="turn" class="px-3 py-1 rounded-full bg-blue-500 text-white font-medium"></span>
            <span class="px-3 py-1 rounded-full bg-gray-200 font-medium">‚è±Ô∏è 15s</span>
        </div>

        <!-- Progress bar -->
        <div class="w-full bg-gray-200 h-2 rounded-full overflow-hidden">
            <div class="bg-blue-500 h-2 timerBar" style="width: 100%;"></div>
        </div>
        <div class="flex justify-center">
        <img src="" alt="Question Image" class="hidden" width="200px" height="150px"/>
        </div>
        <!-- Question -->
        <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-lg text-center">
            <p id="question" class="text-lg font-medium"></p>
        </div>

        <!-- Answer buttons -->
        <div class="grid grid-cols-2 gap-4">
            <button id="0" class="qButtons py-4 border rounded-lg hover:scale-105 transition-transform flex items-center justify-center gap-2">
            </button>
            <button id="1" class="qButtons py-4 border rounded-lg hover:scale-105 transition-transform flex items-center justify-center gap-2">
            </button>
            <button id="2" class="qButtons py-4 border rounded-lg hover:scale-105 transition-transform flex items-center justify-center gap-2">
            </button>
            <button id="3" class="qButtons py-4 border rounded-lg hover:scale-105 transition-transform flex items-center justify-center gap-2">
            </button>
        </div>
    </section>

    <!-- Bingo Boards -->
    <section class="grid lg:grid-cols-2 gap-6">
        <!-- Player 1 Board -->
        <div class="p-4 rounded-2xl bg-white shadow-xl ring-4 ring-blue-500 transform scale-105 transition-all">
            <div class="mb-3 flex items-center justify-between">
                <h3 class="flex items-center gap-2 font-semibold text-gray-800">
                    <span class="w-3 h-3 rounded-full bg-blue-500"></span> Emma
                </h3>
                <span class="px-2 py-1 rounded-full bg-green-500 text-white text-xs font-semibold">
            Your Turn! ‚ö°
          </span>
            </div>
            <div class="grid grid-cols-5 gap-2">
                <!-- 25 squares -->
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">7</div>
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">18</div>
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">35</div>
                <div class="aspect-square bg-blue-500 text-white rounded-lg flex items-center justify-center shadow-lg scale-110">9</div>
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">15</div>
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">21</div>
                <div class="aspect-square bg-yellow-400 text-white rounded-lg flex items-center justify-center">‚òÖ</div>
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">10</div>
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">30</div>
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">12</div>
                <!-- continue 25 total -->
            </div>
        </div>

        <!-- Player 2 Board -->
        <div class="p-4 rounded-2xl bg-white shadow-md opacity-75">
            <div class="mb-3 flex items-center justify-between">
                <h3 class="flex items-center gap-2 font-semibold text-gray-800">
                    <span class="w-3 h-3 rounded-full bg-green-500"></span> Liam
                </h3>
            </div>
            <div class="grid grid-cols-5 gap-2">
                <!-- 25 squares -->
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">8</div>
                <div class="aspect-square bg-green-500 text-white rounded-lg flex items-center justify-center shadow-lg scale-110">11</div>
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">14</div>
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">22</div>
                <div class="aspect-square bg-white border-2 border-gray-200 rounded-lg flex items-center justify-center">24</div>
                <!-- continue 25 total -->
            </div>
        </div>
    </section>

    <div class="text-center text-sm text-gray-500 mt-8">
        <span class="font-semibold">Digitalna Brigada</span>
    </div>
    <script>
        let gameData = [];
        let parameters = {};
        let isCorrectAnswer = false;
        let questionIndex = -1;
        let limitIndex = 20;
        let questionImage = document.querySelector("img");
        
        let timerInterval;
        let timeRemaining = 15;  // Timer starts at 15 seconds
        const progressBar = document.querySelector('.timerBar');
        const timerDisplay = document.querySelector('.px-3.py-1.bg-gray-200');

        const buttons = document.getElementsByClassName("qButtons");
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].addEventListener('click', selectedAnswer, false);
        }
        window.onload = function() {
            enterData();
        };
        async function enterData(){
            parameters = JSON.parse(localStorage.getItem('parameters'));   
            gameData = await window.api.startGame(parameters.grade, parameters.category);
            await (shuffle(gameData));
            console.log("Zmesano: ", gameData);
            limitIndex = gameData.length -1;
            play();
            startTimer();
        }
        function play(){
            questionIndex++;
            if(questionIndex > limitIndex){
                questionIndex = -1;
            }
            if(gameData[questionIndex].image_path != null){
                questionImage.classList.remove("hidden");
                questionImage.src = "./images/" + gameData[questionIndex].image_path + ".png";
            }
            else{
                questionImage.classList.add("hidden");
            }
            document.getElementById("turn").innerText = parameters.players[(questionIndex % 2)] + " je na vrsti";
            document.getElementById("question").innerText = gameData[questionIndex].text;
            document.getElementById("0").innerText = gameData[questionIndex].options[0];
            document.getElementById("1").innerText = gameData[questionIndex].options[1];
            document.getElementById("2").innerText = gameData[questionIndex].options[2];
            document.getElementById("3").innerText = gameData[questionIndex].options[3];
            startTimer();
        }

        async function selectedAnswer(event){
            const button = event.target;
            button.classList.add("border-blue-500", "bg-blue-50", "shadow-md", "selected");
            button.style.animation = "clickAnimation 1.5s linear 0s infinite alternate";
            let answerIndex = 0;
            if(gameData[questionIndex].category === 3){
                answerIndex = button.id + 1;
            }
            else{
                answerIndex = button.id;
            }
            isCorrectAnswer = await window.api.answer(gameData[questionIndex].id, parseInt(answerIndex));
            console.log(button.id);
            setTimeout(function (){
                console.log(isCorrectAnswer);
                button.classList.remove("border-blue-500", "bg-blue-50", "shadow-md", "selected");
                button.classList.add("border-gray-200", "bg-white");
                button.style.animation = "";
                play();
            }, 1000);
        }

        function shuffle(array) {
            let currentIndex = array.length;
            while (currentIndex != 0) {
                let randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [
                array[randomIndex], array[currentIndex]];
            }
        }

        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            timeRemaining = 15;
            updateTimerDisplay(timeRemaining);
            updateProgressBar(timeRemaining);
            // 1x na sekundo
            timerInterval = setInterval(function() {
                timeRemaining--;
                updateTimerDisplay(timeRemaining);
                updateProgressBar(timeRemaining);

                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    play();
                }
            }, 1000);
        }

        function updateTimerDisplay(time) {
            timerDisplay.innerText = `‚è±Ô∏è ${time}s`;
        }

        function updateProgressBar(time) {
            if(time <= 10 && time > 5) {
                progressBar.classList.add("bg-orange-500");
                progressBar.classList.remove("bg-blue-500");
            } else if(time <= 5) {
                progressBar.classList.add("bg-rose-500");
                progressBar.classList.remove("bg-orange-500");
            } else {
                progressBar.classList.add("bg-blue-500");
                progressBar.classList.remove("bg-rose-500");
            }
            const percentage = (time / 15) * 100;
            progressBar.style.width = `${percentage}%`;
        }
    </script>
</main>

</body>
</html>
